# 🗃️ KwooLa-Text2SQL组件 ✨

欢迎来到天工开悟问答大模型SQL功能的演示项目！这里提供了功能的使用方法及示例文件。

> 🌟 **KwooLa 完整项目**，请访问主仓库：[https://github.com/HIT-Kwoo/KwooLa/tree/main](https://github.com/HIT-Kwoo/KwooLa/tree/main)

## 🚀 项目概述

本项目基于天工开悟大模型，实现了一个高效的 **TEXT2SQL** 框架。用户仅需提供数据库和自然语言问题，系统即可自动编写对应的SQL查询，执行并获取结果，最终由天工开悟大模型整合信息，生成流畅的自然语言回复。

本功能极大地降低了非专业人员操作数据库的门槛，为各类数据信息的获取工作节省了大量时间和精力。

## ✨ 项目特性

我们的 Text2SQL 框架包含三大核心环节，确保查询准确、高效：

*   **🔍 数据表检索 (Table Retrieval)**
    研究团队提出了一种基于实体移除的迭代式检索方法。在每一轮检索中，大模型会根据已找到的表信息，移除问题中的相关实体并重写为结构化表示，再与表信息对齐进行新一轮检索。结合束搜索（Beam Search）和早停（Early Stopping）机制，确保了召回信息的**多样性、高相关性和精简性**。

*   **✍️ SQL生成 (SQL Generation)**
    我们选择了基于 Qwen-2.5-Coder 系列微调的 **XiYan-SQL** 模型作为SQL生成器。通过精心设计的结构化提示（Prompt），将检索到的表信息高效地传递给大模型，并利用 Few-shot 等技巧，显著提高了生成SQL的**执行准确率**。

*   **🔄 结果后处理 (Result Post-processing)**
    模型会对问题、表信息、SQL语句、执行结果及错误信息进行**自我反思**。对于置信度较低的结果，系统会启动修正流程，确保最终输出的**正确性与稳定性**。

## ▶️ 使用方法

以天工开悟网页版为例，只需三步即可体验：

**1. 📂 上传数据库文件**

首先，准备一个 `.sqlite` 或 `.db` 类型的数据库文件，然后点击“上传表格”按钮并选择该文件。
**您可以使用本项目中的 `farm.sqlite` 文件进行快速测试。**

<div align="center">
<img src="./image/文件上传位置.png" ></img> 
</div>

**2. 🎉 开始自然语言提问**

文件上传成功后，会显示在附件区域。现在，您可以直接在对话框中针对该数据库进行自然语言提问了。

<div align="center">
<img src="./image/上传成功示例.png" ></img> 
</div>


**3. 💬 获取智能回答**

天工开悟将自动分析数据库结构与内容，生成SQL查询并执行，最终用通俗易懂的自然语言回答您的问题。

<div align="center">
<img src="./image/回答成功示例.png" ></img> 
</div>
